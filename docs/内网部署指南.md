# Smart Water å†…ç½‘éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•é€šè¿‡ U ç›˜å°†é¡¹ç›®ä»è”ç½‘æœºå™¨éƒ¨ç½²åˆ°å†…ç½‘æœºå™¨ã€‚

---

## ğŸ“‹ éƒ¨ç½²æµç¨‹æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         Uç›˜          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è”ç½‘æœºå™¨       â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚   å†…ç½‘æœºå™¨       â”‚
â”‚                 â”‚                      â”‚                 â”‚
â”‚  1. æ‹‰å–é•œåƒ     â”‚   é•œåƒ tar æ–‡ä»¶      â”‚  1. åŠ è½½é•œåƒ     â”‚
â”‚  2. æ„å»ºé•œåƒ     â”‚   + é¡¹ç›®ä»£ç          â”‚  2. é…ç½®ç¯å¢ƒ     â”‚
â”‚  3. å¯¼å‡ºåˆ° tar   â”‚                      â”‚  3. å¯åŠ¨æœåŠ¡     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šè”ç½‘æœºå™¨æ“ä½œ

### 1. ç¯å¢ƒè¦æ±‚

- Windows 10/11 æˆ– Linux
- Docker Desktop å·²å®‰è£…å¹¶è¿è¡Œ
- é¡¹ç›®ä»£ç å·²å…‹éš†

### 2. ä¸€é”®æ‰“åŒ…ï¼ˆæ¨èï¼‰

```powershell
# è¿›å…¥é¡¹ç›®ç›®å½•

# è¿è¡Œæ‰“åŒ…è„šæœ¬
.\docker\save_docker_images.ps1
```

è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œï¼š
1. âœ… æ‹‰å–æ‰€æœ‰åŸºç¡€é•œåƒ
2. âœ… æ„å»º API å’Œ Web é•œåƒ
3. âœ… å¯¼å‡ºåˆ° `docker_images_backup\` ç›®å½•
4. âœ… ç”Ÿæˆéƒ¨ç½²æ¸…å•

### 3. å¦‚æœç½‘ç»œä¸å¥½

ä½¿ç”¨é•œåƒåŠ é€Ÿæ‹‰å–ï¼š

```bash
# ä½¿ç”¨ DaoCloud é•œåƒåŠ é€Ÿï¼ˆLinux/Git Bashï¼‰
./docker/pull_image.sh python:3.12-slim
./docker/pull_image.sh neo4j:5.26
./docker/pull_image.sh milvusdb/milvus:v2.5.6
```

### 4. éœ€è¦å¤åˆ¶åˆ° U ç›˜çš„æ–‡ä»¶

```
Uç›˜/
â”œâ”€â”€ docker_images_backup/
â”‚   â”œâ”€â”€ smart_water_images_YYYYMMDD_HHMM.tar  # ~5-8 GB
â”‚   â””â”€â”€ éƒ¨ç½²æ¸…å•_YYYYMMDD_HHMM.txt
â””â”€â”€ Yuxi-Know-main/                            # é¡¹ç›®ä»£ç ï¼ˆå®Œæ•´ç›®å½•ï¼‰
    â”œâ”€â”€ docker/
    â”œâ”€â”€ docker-compose.yml
    â”œâ”€â”€ server/
    â”œâ”€â”€ src/
    â”œâ”€â”€ web/
    â”œâ”€â”€ .env.template
    â”œâ”€â”€ deploy.ps1
    â””â”€â”€ ...
```

> [!IMPORTANT]
> ç¡®ä¿ U ç›˜å‰©ä½™ç©ºé—´ > 15 GBï¼ˆFAT32 æ ¼å¼ä¸æ”¯æŒå¤§äº 4GB çš„å•ä¸ªæ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ NTFS æˆ– exFAT æ ¼å¼ï¼‰

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šå†…ç½‘æœºå™¨æ“ä½œ

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å†…ç½‘æœºå™¨å·²å®‰è£…ï¼š
- Docker Desktopï¼ˆWindowsï¼‰æˆ– Docker Engineï¼ˆLinuxï¼‰
- Docker Compose V2

### 2. å¤åˆ¶æ–‡ä»¶

ä» U ç›˜å¤åˆ¶åˆ°å†…ç½‘æœºå™¨ï¼š

```powershell
# ç¤ºä¾‹ï¼šå¤åˆ¶åˆ° D:\projects\
copy-item -Recurse E:\Yuxi-Know-main D:\projects\
copy-item -Recurse E:\docker_images_backup D:\projects\
```

### 3. åŠ è½½ Docker é•œåƒ

```powershell
# è¿›å…¥ç›®å½•
cd D:\projects

# åŠ è½½é•œåƒï¼ˆçº¦éœ€ 5-10 åˆ†é’Ÿï¼‰
docker load -i docker_images_backup\smart_water_images_*.tar

# éªŒè¯é•œåƒå·²åŠ è½½
docker images
```

é¢„æœŸè¾“å‡ºï¼š
```
REPOSITORY                     TAG                            SIZE
smart-water-api                1.0.0                          ~1.5 GB
smart-water-web                1.0.0                          ~500 MB
neo4j                          5.26                           ~600 MB
milvusdb/milvus                v2.5.6                         ~1.5 GB
minio/minio                    RELEASE.2023-03-20T20-16-18Z   ~200 MB
quay.io/coreos/etcd            v3.5.5                         ~50 MB
```

### 4. é…ç½®ç¯å¢ƒå˜é‡

```powershell
cd D:\projects\Yuxi-Know-main

# åˆ›å»ºé…ç½®æ–‡ä»¶
copy .env.template .env

# ç¼–è¾‘é…ç½®
notepad .env
```

**å¿…é¡»é…ç½®çš„é¡¹ç›®**ï¼š

```ini
# ========== LLM API é…ç½® ==========
# æ–¹å¼ä¸€ï¼šä½¿ç”¨å†…ç½‘ vLLM æœåŠ¡
OPENAI_API_BASE=http://192.168.x.x:8000/v1
OPENAI_API_KEY=no-key-needed

# æ–¹å¼äºŒï¼šä½¿ç”¨ç¡…åŸºæµåŠ¨ç­‰äº‘æœåŠ¡ï¼ˆå¦‚å†…ç½‘å¯è®¿é—®ï¼‰
SILICONFLOW_API_KEY=sk-xxxxx

# ========== ç®¡ç†å‘˜è´¦å· ==========
YUXI_SUPER_ADMIN_NAME=admin
YUXI_SUPER_ADMIN_PASSWORD=your_secure_password

# ========== æ•°æ®åº“å¯†ç  ==========
NEO4J_PASSWORD=0123456789
```

### 5. å¯åŠ¨æœåŠ¡

```powershell
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬å¯åŠ¨
.\deploy.ps1 start

# æˆ–ç›´æ¥ä½¿ç”¨ docker compose
docker compose up -d
```

### 6. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```powershell
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
.\deploy.ps1 status

# æŸ¥çœ‹æ—¥å¿—
.\deploy.ps1 logs
```

ç­‰å¾…æ‰€æœ‰æœåŠ¡å˜ä¸º `healthy`ï¼ˆçº¦ 3-5 åˆ†é’Ÿï¼‰ã€‚

### 7. è®¿é—®æœåŠ¡

| æœåŠ¡ | åœ°å€ | ç”¨é€” |
|------|------|------|
| **å‰ç«¯ç•Œé¢** | http://localhost:5173 | ç”¨æˆ·è®¿é—®å…¥å£ |
| **API æ–‡æ¡£** | http://localhost:5050/docs | Swagger API æ–‡æ¡£ |
| **Neo4j æµè§ˆå™¨** | http://localhost:7474 | å›¾æ•°æ®åº“ç®¡ç† |
| **MinIO æ§åˆ¶å°** | http://localhost:9001 | å¯¹è±¡å­˜å‚¨ç®¡ç† |

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šGPU æœåŠ¡éƒ¨ç½²ï¼ˆMinerU / PaddleX OCRï¼‰

> [!WARNING]
> GPU æœåŠ¡é•œåƒéœ€è¦åœ¨è”ç½‘æœºå™¨ä¸Š**å®Œæ•´æ„å»º**ï¼Œä¸èƒ½åªä¸‹è½½åŸºç¡€é•œåƒï¼
> æ„å»ºè¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨ä¸‹è½½ AI æ¨¡å‹æ–‡ä»¶ï¼ˆçº¦ 5-10GBï¼‰ï¼Œè¿™äº›æ¨¡å‹ä¼šè¢«æ‰“åŒ…åˆ°é•œåƒä¸­ã€‚

### ç¡¬ä»¶è¦æ±‚

| ç»„ä»¶ | æœ€ä½è¦æ±‚ | æ¨èé…ç½® |
|------|---------|---------|
| GPU | NVIDIA GPU 8GB æ˜¾å­˜ | 16GB+ æ˜¾å­˜ |
| Driver | >= 525 | >= 535 |
| CUDA | 12.6 | 12.6 |
| ç³»ç»Ÿç»„ä»¶ | nvidia-container-toolkit | |

---

### MinerU OCR æœåŠ¡

MinerU æ˜¯ä¸€ä¸ªæ–‡æ¡£ OCR æœåŠ¡ï¼Œç”¨äºæå– PDF/å›¾ç‰‡ä¸­çš„æ–‡å­—ã€‚

#### é•œåƒè¯´æ˜

```dockerfile
# docker/mineru.Dockerfile å…³é”®å†…å®¹ï¼š
FROM lmsysorg/sglang:v0.4.9.post3-cu126     # åŸºç¡€é•œåƒ ~15GB
RUN pip install mineru[core]                 # å®‰è£… Python åŒ…
RUN mineru-models-download -s modelscope -m all  # ä¸‹è½½æ¨¡å‹ ~5-10GB
```

| é˜¶æ®µ | é•œåƒå¤§å° | è¯´æ˜ |
|------|---------|------|
| åŸºç¡€é•œåƒ | ~15 GB | `lmsysorg/sglang:v0.4.9.post3-cu126` |
| æ„å»ºå | ~20-25 GB | åŒ…å« MinerU + æ‰€æœ‰æ¨¡å‹ |

#### è”ç½‘æœºå™¨ï¼šæ„å»º MinerU é•œåƒ

```powershell
cd d:\å¤§åæœ€æ–°é¡¹ç›®\Yuxi-Know-main

# æ­¥éª¤ 1: æ‹‰å–åŸºç¡€é•œåƒï¼ˆçº¦ 15GBï¼Œè€å¿ƒç­‰å¾…ï¼‰
docker pull lmsysorg/sglang:v0.4.9.post3-cu126

# æ­¥éª¤ 2: æ„å»º MinerU é•œåƒï¼ˆä¼šä¸‹è½½æ¨¡å‹ï¼Œçº¦ 30-60 åˆ†é’Ÿï¼‰
docker compose build mineru

# æ­¥éª¤ 3: éªŒè¯é•œåƒå·²æ„å»º
docker images | findstr mineru
# é¢„æœŸè¾“å‡ºï¼šmineru-sglang   latest   xxxxx   20-25GB

# æ­¥éª¤ 4: å¯¼å‡ºé•œåƒ
docker save mineru-sglang:latest -o docker_images_backup/mineru_ocr.tar
```

> [!TIP]
> å¦‚æœåŸºç¡€é•œåƒä¸‹è½½æ…¢ï¼Œå¯ä½¿ç”¨é•œåƒåŠ é€Ÿï¼š
> ```bash
> ./docker/pull_image.sh lmsysorg/sglang:v0.4.9.post3-cu126
> ```

#### å†…ç½‘æœºå™¨ï¼šåŠ è½½å¹¶å¯åŠ¨

```powershell
# åŠ è½½é•œåƒï¼ˆçº¦ 10-15 åˆ†é’Ÿï¼‰
docker load -i docker_images_backup/mineru_ocr.tar

# å¯åŠ¨åŒ…å« GPU æœåŠ¡çš„å®Œæ•´ç¯å¢ƒ
.\deploy.ps1 start-all

# æˆ–åªå¯åŠ¨ MinerU æœåŠ¡
docker compose --profile all up -d mineru
```

#### éªŒè¯ MinerU æœåŠ¡

```powershell
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker compose ps mineru

# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:30000/health
```

---

### PaddleX OCR æœåŠ¡

PaddleX æ˜¯ç™¾åº¦çš„æ–‡æ¡£ç»“æ„è¯†åˆ«æœåŠ¡ï¼Œæ”¯æŒè¡¨æ ¼ã€å…¬å¼ã€å°ç« ç­‰è¯†åˆ«ã€‚

#### é•œåƒè¯´æ˜

```dockerfile
# docker/paddlex.Dockerfile å…³é”®å†…å®¹ï¼š
FROM ccr-2vdh3abv-pub.cnc.bj.baidubce.com/paddlex/paddlex:paddlex3.0.1-...
RUN paddlex --install hpi-cpu
RUN paddlex --install serving
```

| é˜¶æ®µ | é•œåƒå¤§å° | è¯´æ˜ |
|------|---------|------|
| åŸºç¡€é•œåƒ | ~20 GB | ç™¾åº¦äº‘é•œåƒ |
| æ„å»ºå | ~22 GB | åŒ…å« PaddleX + é…ç½® |

#### è”ç½‘æœºå™¨ï¼šæ„å»º PaddleX é•œåƒ

```powershell
# æ­¥éª¤ 1: æ‹‰å–åŸºç¡€é•œåƒï¼ˆç™¾åº¦äº‘ï¼Œå›½å†…é€Ÿåº¦è¾ƒå¿«ï¼‰
docker pull ccr-2vdh3abv-pub.cnc.bj.baidubce.com/paddlex/paddlex:paddlex3.0.1-paddlepaddle3.0.0-gpu-cuda11.8-cudnn8.9-trt8.6

# æ­¥éª¤ 2: æ„å»º PaddleX é•œåƒ
docker compose build paddlex

# æ­¥éª¤ 3: å¯¼å‡ºé•œåƒ
docker save paddlex:latest -o docker_images_backup/paddlex_ocr.tar
```

#### å†…ç½‘æœºå™¨ï¼šåŠ è½½å¹¶å¯åŠ¨

```powershell
docker load -i docker_images_backup/paddlex_ocr.tar
docker compose --profile all up -d paddlex
```

---

### GPU æœåŠ¡ä¸€é”®æ‰“åŒ…

ä½¿ç”¨æ‰“åŒ…è„šæœ¬è‡ªåŠ¨å¤„ç†ï¼š

```powershell
# è”ç½‘æœºå™¨ï¼šæ„å»ºå¹¶å¯¼å‡ºæ‰€æœ‰é•œåƒï¼ˆåŒ…æ‹¬ GPU æœåŠ¡ï¼‰
.\docker\save_docker_images.ps1 -IncludeGpu

# ç”Ÿæˆçš„æ–‡ä»¶ï¼š
# - docker_images_backup/smart_water_images_*.tar      (~5-8 GB)
# - docker_images_backup/smart_water_gpu_images_*.tar  (~40-50 GB)
```

### U ç›˜æ ¼å¼è¦æ±‚

å› ä¸º GPU é•œåƒæ–‡ä»¶å¾ˆå¤§ï¼Œ**å¿…é¡»ä½¿ç”¨ NTFS æˆ– exFAT æ ¼å¼**ï¼š

```powershell
# æ£€æŸ¥ U ç›˜æ ¼å¼
Get-Volume -DriveLetter E | Select-Object FileSystemType

# å¦‚æœæ˜¯ FAT32ï¼Œéœ€è¦é‡æ–°æ ¼å¼åŒ–ä¸º NTFS
# è­¦å‘Šï¼šä¼šæ¸…é™¤æ‰€æœ‰æ•°æ®ï¼
Format-Volume -DriveLetter E -FileSystem NTFS -Confirm
```

---

### å¸¸è§é—®é¢˜

#### Q: ä¸ºä»€ä¹ˆä¸èƒ½åªä¸‹è½½åŸºç¡€é•œåƒï¼Ÿ

A: MinerU çš„ Dockerfile ä¸­æœ‰ `mineru-models-download` æ­¥éª¤ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šåœ¨æ„å»ºæ—¶ä» ModelScope ä¸‹è½½çº¦ 5-10GB çš„ AI æ¨¡å‹ã€‚å¦‚æœåªä¸‹è½½åŸºç¡€é•œåƒï¼Œå†…ç½‘æ„å»ºæ—¶æ— æ³•ä¸‹è½½æ¨¡å‹ä¼šå¯¼è‡´å¤±è´¥ã€‚

#### Q: GPU é•œåƒå¤ªå¤§æ€ä¹ˆåŠï¼Ÿ

A: å¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–¹æ¡ˆï¼š
1. åˆ†å·å‹ç¼©ï¼šä½¿ç”¨ 7-Zip å°† tar æ–‡ä»¶åˆ†å‰²æˆå¤šä¸ª 4GB ä»¥ä¸‹çš„æ–‡ä»¶
2. ä½¿ç”¨ç§»åŠ¨ç¡¬ç›˜ï¼šæ¯” U ç›˜ä¼ è¾“æ›´å¿«
3. å†…ç½‘æ­å»ºä¸´æ—¶ Docker Registryï¼šä¸€æ¬¡ä¼ è¾“ï¼Œå¤šæœºä½¿ç”¨

#### Q: æ²¡æœ‰ GPU èƒ½ç”¨ OCR å—ï¼Ÿ

A: ä¸èƒ½åœ¨æœ¬åœ°è¿è¡Œ MinerU/PaddleXï¼Œä½†å¯ä»¥ï¼š
1. ä½¿ç”¨å¤–éƒ¨ OCR API æœåŠ¡
2. åœ¨æœ‰ GPU çš„æœåŠ¡å™¨ä¸Šéƒ¨ç½² OCR æœåŠ¡ï¼ŒAPI æ–¹å¼è°ƒç”¨

---

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼šé•œåƒåŠ è½½å¤±è´¥

```powershell
# æ£€æŸ¥ tar æ–‡ä»¶å®Œæ•´æ€§
tar -tf smart_water_images_*.tar | Select-Object -First 10

# å¦‚æ–‡ä»¶æŸåï¼Œéœ€é‡æ–°ä»è”ç½‘æœºå™¨å¤åˆ¶
```

### é—®é¢˜ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥

```powershell
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
docker compose logs api
docker compose logs milvus

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -ano | findstr "5050"
netstat -ano | findstr "5173"
```

### é—®é¢˜ï¼šAPI æ— æ³•è¿æ¥ LLM

ç¡®ä¿ `.env` ä¸­çš„ LLM é…ç½®æ­£ç¡®ï¼š

```ini
# æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯è¾¾
curl http://192.168.x.x:8000/v1/models
```

### é—®é¢˜ï¼šå‰ç«¯æ— æ³•è®¿é—®åç«¯

æ£€æŸ¥ Docker ç½‘ç»œï¼š

```powershell
# ç¡®ä¿å®¹å™¨åœ¨åŒä¸€ç½‘ç»œ
docker network ls
docker network inspect yuxi-know-main_app-network
```

---

## é™„å½•ï¼šé•œåƒæ¸…å•

| é•œåƒ | ç‰ˆæœ¬ | å¤§å° | ç”¨é€” |
|------|------|------|------|
| `smart-water-api` | 1.0.0 | ~1.5GB | åç«¯ API |
| `smart-water-web` | 1.0.0 | ~500MB | å‰ç«¯æœåŠ¡ |
| `neo4j` | 5.26 | ~600MB | å›¾æ•°æ®åº“ |
| `milvusdb/milvus` | v2.5.6 | ~1.5GB | å‘é‡æ•°æ®åº“ |
| `minio/minio` | RELEASE.2023-03-20T20-16-18Z | ~200MB | å¯¹è±¡å­˜å‚¨ |
| `quay.io/coreos/etcd` | v3.5.5 | ~50MB | Milvus ä¾èµ– |

---

## é™„å½•ï¼šæ–‡ä»¶è¯´æ˜

| æ–‡ä»¶/ç›®å½• | è¯´æ˜ |
|----------|------|
| `docker-compose.yml` | æœåŠ¡ç¼–æ’é…ç½® |
| `docker/api.Dockerfile` | API é•œåƒæ„å»ºæ–‡ä»¶ |
| `docker/web.Dockerfile` | Web é•œåƒæ„å»ºæ–‡ä»¶ |
| `docker/save_docker_images.ps1` | é•œåƒæ‰“åŒ…è„šæœ¬ |
| `docker/pull_image.sh` | é•œåƒåŠ é€Ÿæ‹‰å–è„šæœ¬ |
| `docker/nginx/` | Nginx é…ç½®æ–‡ä»¶ |
| `docker/volumes/` | æ•°æ®æŒä¹…åŒ–ç›®å½• |
| `.env` | ç¯å¢ƒå˜é‡é…ç½® |
| `deploy.ps1` | éƒ¨ç½²ç®¡ç†è„šæœ¬ |

---

## é™„å½•ï¼šæ•°æ®å¤‡ä»½ä¸æ¢å¤

### æ•°æ®å­˜å‚¨ä½ç½®

æ‰€æœ‰æŒä¹…åŒ–æ•°æ®å­˜å‚¨åœ¨ `docker/volumes/` ç›®å½•ä¸‹ï¼š

```
docker/volumes/
â”œâ”€â”€ neo4j/
â”‚   â”œâ”€â”€ data/          # Neo4j å›¾æ•°æ®åº“æ•°æ®
â”‚   â””â”€â”€ logs/          # Neo4j æ—¥å¿—
â”œâ”€â”€ milvus/
â”‚   â”œâ”€â”€ milvus/        # Milvus å‘é‡æ•°æ®
â”‚   â”œâ”€â”€ etcd/          # Milvus å…ƒæ•°æ®
â”‚   â”œâ”€â”€ minio/         # MinIO å¯¹è±¡å­˜å‚¨æ•°æ®
â”‚   â””â”€â”€ logs/          # Milvus æ—¥å¿—
â””â”€â”€ paddlex/           # PaddleX æ•°æ®
```

### å¤‡ä»½æ•°æ®

```powershell
# åœæ­¢æœåŠ¡ï¼ˆç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼‰
.\deploy.ps1 stop

# å¤‡ä»½æ•´ä¸ª volumes ç›®å½•
$BackupDate = Get-Date -Format "yyyyMMdd"
Compress-Archive -Path "docker/volumes" -DestinationPath "backup_$BackupDate.zip"

# é‡æ–°å¯åŠ¨æœåŠ¡
.\deploy.ps1 start
```

### å¤‡ä»½å•ä¸ªæœåŠ¡

```powershell
# åªå¤‡ä»½ Neo4j æ•°æ®
docker run --rm -v yuxi-know-main_neo4j-data:/data -v ${PWD}:/backup alpine tar czf /backup/neo4j_backup.tar.gz /data

# åªå¤‡ä»½ Milvus æ•°æ®
Compress-Archive -Path "docker/volumes/milvus" -DestinationPath "milvus_backup.zip"
```

### æ¢å¤æ•°æ®

```powershell
# åœæ­¢æœåŠ¡
.\deploy.ps1 stop

# åˆ é™¤æ—§æ•°æ®ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰
Remove-Item -Recurse -Force "docker/volumes"

# è§£å‹å¤‡ä»½æ•°æ®
Expand-Archive -Path "backup_YYYYMMDD.zip" -DestinationPath "docker/"

# é‡æ–°å¯åŠ¨æœåŠ¡
.\deploy.ps1 start
```

### è¿ç§»åˆ°æ–°æœºå™¨

```powershell
# åœ¨æ—§æœºå™¨ä¸Š
.\deploy.ps1 stop
Compress-Archive -Path "docker/volumes" -DestinationPath "data_migration.zip"

# å¤åˆ¶åˆ°æ–°æœºå™¨å
Expand-Archive -Path "data_migration.zip" -DestinationPath "docker/"
.\deploy.ps1 start
```

---

## é™„å½•ï¼šGPU æœåŠ¡ä¾èµ–ç¦»çº¿å®‰è£…

åœ¨å†…ç½‘æœºå™¨ä¸Šè¿è¡Œ GPU æœåŠ¡éœ€è¦å®‰è£… NVIDIA Container Toolkitã€‚

### Windows ç¯å¢ƒ

Windows ä½¿ç”¨ Docker Desktopï¼ŒGPU æ”¯æŒé€šè¿‡ WSL2 å®ç°ï¼š

1. **å®‰è£… NVIDIA GPU é©±åŠ¨**ï¼ˆå¿…é¡»è”ç½‘ä¸‹è½½åç¦»çº¿å®‰è£…ï¼‰
   - ä» [NVIDIA å®˜ç½‘](https://www.nvidia.com/drivers) ä¸‹è½½å¯¹åº”å‹å·çš„é©±åŠ¨
   - å¤åˆ¶åˆ°å†…ç½‘æœºå™¨å®‰è£…

2. **é…ç½® Docker Desktop**
   - ç¡®ä¿ Docker Desktop ä½¿ç”¨ WSL2 åç«¯
   - Settings â†’ Resources â†’ WSL Integration â†’ å¯ç”¨

3. **éªŒè¯ GPU å¯ç”¨**
   ```powershell
   docker run --rm --gpus all nvidia/cuda:12.0-base nvidia-smi
   ```

### Linux ç¯å¢ƒ (Ubuntu/Debian)

#### æ­¥éª¤ 1ï¼šä¸‹è½½ç¦»çº¿å®‰è£…åŒ…ï¼ˆåœ¨è”ç½‘æœºå™¨ä¸Šï¼‰

```bash
# åˆ›å»ºä¸‹è½½ç›®å½•
mkdir -p nvidia_offline && cd nvidia_offline

# ä¸‹è½½ NVIDIA é©±åŠ¨ï¼ˆæ ¹æ® GPU å‹å·é€‰æ‹©ï¼‰
wget https://us.download.nvidia.com/XFree86/Linux-x86_64/535.129.03/NVIDIA-Linux-x86_64-535.129.03.run

# ä¸‹è½½ nvidia-container-toolkit
# æ·»åŠ ä»“åº“å¹¶ä¸‹è½½åŒ…
curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg

# ä¸‹è½½æ‰€éœ€çš„ deb åŒ…
apt-get download nvidia-container-toolkit nvidia-container-toolkit-base libnvidia-container1 libnvidia-container-tools

# æ‰“åŒ…æ‰€æœ‰æ–‡ä»¶
cd ..
tar czf nvidia_offline.tar.gz nvidia_offline/
```

#### æ­¥éª¤ 2ï¼šç¦»çº¿å®‰è£…ï¼ˆåœ¨å†…ç½‘æœºå™¨ä¸Šï¼‰

```bash
# è§£å‹
tar xzf nvidia_offline.tar.gz
cd nvidia_offline

# å®‰è£… NVIDIA é©±åŠ¨
chmod +x NVIDIA-Linux-x86_64-*.run
sudo ./NVIDIA-Linux-x86_64-*.run --silent

# å®‰è£… nvidia-container-toolkit
sudo dpkg -i *.deb

# é…ç½® Docker ä½¿ç”¨ NVIDIA runtime
sudo nvidia-ctk runtime configure --runtime=docker
sudo systemctl restart docker

# éªŒè¯
docker run --rm --gpus all nvidia/cuda:12.0-base nvidia-smi
```

### CentOS/RHEL ç¯å¢ƒ

```bash
# åœ¨è”ç½‘æœºå™¨ä¸Šä¸‹è½½ RPM åŒ…
yumdownloader nvidia-container-toolkit --resolve --destdir=./nvidia_rpms

# åœ¨å†…ç½‘æœºå™¨ä¸Šå®‰è£…
sudo rpm -ivh nvidia_rpms/*.rpm
```

---

## é™„å½•ï¼šLinux ç‰ˆæœ¬éƒ¨ç½²è¯´æ˜

### ç¯å¢ƒè¦æ±‚

- Ubuntu 20.04+ / Debian 11+ / CentOS 8+
- Docker Engine 20.10+
- Docker Compose V2 (docker compose å‘½ä»¤)

### ä¸€é”®æ‰“åŒ…ï¼ˆè”ç½‘æœºå™¨ï¼‰

```bash
cd /path/to/Yuxi-Know-main

# è¿è¡Œæ‰“åŒ…è„šæœ¬
chmod +x docker/save_docker_images.sh
./docker/save_docker_images.sh
```

### éƒ¨ç½²æ­¥éª¤ï¼ˆå†…ç½‘æœºå™¨ï¼‰

#### 1. å®‰è£… Dockerï¼ˆç¦»çº¿ï¼‰

```bash
# åœ¨è”ç½‘æœºå™¨ä¸Šä¸‹è½½ Docker ç¦»çº¿åŒ…
# è®¿é—® https://download.docker.com/linux/static/stable/x86_64/
# ä¸‹è½½ docker-24.0.7.tgz

# åœ¨å†…ç½‘æœºå™¨ä¸Šå®‰è£…
tar xzf docker-24.0.7.tgz
sudo cp docker/* /usr/bin/

# åˆ›å»º systemd æœåŠ¡
sudo tee /etc/systemd/system/docker.service << 'EOF'
[Unit]
Description=Docker Application Container Engine
After=network-online.target

[Service]
Type=notify
ExecStart=/usr/bin/dockerd
Restart=always

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable docker
sudo systemctl start docker
```

#### 2. åŠ è½½é•œåƒ

```bash
cd /path/to/project

# åŠ è½½é•œåƒ
docker load -i docker_images_backup/smart_water_images_*.tar

# éªŒè¯
docker images
```

#### 3. é…ç½®ç¯å¢ƒ

```bash
cd Yuxi-Know-main

# åˆ›å»ºé…ç½®æ–‡ä»¶
cp .env.template .env

# ç¼–è¾‘é…ç½®
nano .env  # æˆ– vim .env
```

#### 4. å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬
chmod +x deploy.sh
./deploy.sh start

# æˆ–ç›´æ¥ä½¿ç”¨ docker compose
docker compose up -d

# æŸ¥çœ‹çŠ¶æ€
docker compose ps
```

#### 5. é…ç½®é˜²ç«å¢™

```bash
# Ubuntu/Debian (ufw)
sudo ufw allow 5173/tcp  # å‰ç«¯
sudo ufw allow 5050/tcp  # API
sudo ufw allow 7474/tcp  # Neo4j
sudo ufw allow 9001/tcp  # MinIO

# CentOS/RHEL (firewalld)
sudo firewall-cmd --permanent --add-port=5173/tcp
sudo firewall-cmd --permanent --add-port=5050/tcp
sudo firewall-cmd --permanent --add-port=7474/tcp
sudo firewall-cmd --permanent --add-port=9001/tcp
sudo firewall-cmd --reload
```

### Linux å¸¸ç”¨å‘½ä»¤å¯¹ç…§è¡¨

| æ“ä½œ | Windows (PowerShell) | Linux (Bash) |
|------|---------------------|--------------|
| å¯åŠ¨æœåŠ¡ | `.\deploy.ps1 start` | `./deploy.sh start` |
| åœæ­¢æœåŠ¡ | `.\deploy.ps1 stop` | `./deploy.sh stop` |
| æŸ¥çœ‹çŠ¶æ€ | `.\deploy.ps1 status` | `./deploy.sh status` |
| æŸ¥çœ‹æ—¥å¿— | `.\deploy.ps1 logs` | `./deploy.sh logs` |
| å¤åˆ¶æ–‡ä»¶ | `copy-item` | `cp` |
| å‹ç¼©æ–‡ä»¶ | `Compress-Archive` | `tar czf` |
| è§£å‹æ–‡ä»¶ | `Expand-Archive` | `tar xzf` |
| ç¼–è¾‘æ–‡ä»¶ | `notepad` | `nano` / `vim` |

### Linux ä¸“æœ‰é—®é¢˜

#### æƒé™é—®é¢˜

```bash
# å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ° docker ç»„
sudo usermod -aG docker $USER

# é‡æ–°ç™»å½•æˆ–æ‰§è¡Œ
newgrp docker
```

#### volumes ç›®å½•æƒé™

```bash
# å¦‚æœé‡åˆ°æƒé™é—®é¢˜
sudo chown -R 1000:1000 docker/volumes/neo4j
sudo chown -R 1000:1000 docker/volumes/milvus
```

#### SELinux é—®é¢˜ï¼ˆCentOS/RHELï¼‰

```bash
# ä¸´æ—¶ç¦ç”¨
sudo setenforce 0

# æˆ–æ·»åŠ  Docker å·æ ‡ç­¾
docker run -v /path:/container:Z ...
```

ä¸Šä¼ å›¾æ•°æ®å‰å¼„.envæ–‡ä»¶ï¼Œä¸ç„¶500æŠ¥é”™
